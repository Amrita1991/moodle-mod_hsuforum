YUI.add("moodle-mod_hsuforum-article",function(r,s){var o,a="hsuforum-thread-edit",d="hsuforum-post-edit",u={ADD_DISCUSSION:"#newdiscussionform input[type=submit]",ADD_DISCUSSION_TARGET:".hsuforum-add-discussion-target",ALL_FORMS:".hsuforum-reply-wrapper form",CONTAINER:".mod-hsuforum-posts-container",CONTAINER_LINKS:".mod-hsuforum-posts-container a",DISCUSSION:".hsuforum-thread",DISCUSSIONS:".hsuforum-threads-wrapper",DISCUSSION_EDIT:"."+a,DISCUSSION_BY_ID:'.hsuforum-thread[data-discussionid="%d"]',DISCUSSION_COUNT:".hsuforum-discussion-count",DISCUSSION_TARGET:".hsuforum-new-discussion-target",DISCUSSION_TEMPLATE:"#hsuforum-discussion-template",DISCUSSION_VIEW:".hsuforum-thread-view",EDITABLE_MESSAGE:"[contenteditable]",EDITABLE_MESSAGE_ATTO:'[id^="editor-target-container"][contenteditable]:not([style*="display: none"])',FORM:".hsuforum-form",FORM_ADVANCED:".hsuforum-use-advanced",FORM_REPLY_WRAPPER:".hsuforum-reply-wrapper",INPUT_FORUM:'input[name="forum"]',INPUT_MESSAGE:'textarea[name="message"]',INPUT_REPLY:'input[name="reply"]',INPUT_SUBJECT:'input[name="subject"]',LINK_CANCEL:".hsuforum-cancel",NO_DISCUSSIONS:".forumnodiscuss",NOTIFICATION:".hsuforum-notification",OPTIONS_TO_PROCESS:".hsuforum-options-menu.unprocessed",PLACEHOLDER:".thread-replies-placeholder",POSTS:".hsuforum-thread-replies",POST_BY_ID:'.hsuforum-post-target[data-postid="%d"]',POST_EDIT:"."+d,POST_TARGET:".hsuforum-post-target",RATE:".forum-post-rating",RATE_POPUP:".forum-post-rating a",REPLY_TEMPLATE:"#hsuforum-reply-template",SEARCH_PAGE:"#page-mod-hsuforum-search",VALIDATION_ERRORS:".hsuforum-validation-errors",VIEW_POSTS:".hsuforum-view-posts"},n="discussion:created",l="discussion:deleted",h="form:canceled",f="post:created",c="post:deleted",m="post:updated";function e(){e.superclass.constructor.apply(this,arguments)}function t(){t.superclass.constructor.apply(this,arguments)}function i(){i.superclass.constructor.apply(this,arguments)}M.mod_hsuforum=M.mod_hsuforum||{},e.NAME="moodle-mod_hsuforum-dom",e.ATTRS={io:{value:null}},r.extend(e,r.Base,{initializer:function(){r.all(u.RATE).addClass("processed"),this.initOptionMenus()},initFeatures:function(){this.initOptionMenus(),this.initRatings()},initRatings:function(){r.all(u.RATE).each(function(e){e.hasClass("processed")||(M.core_rating.Y=r,e.all("select.postratingmenu").each(M.core_rating.attach_rating_events,M.core_rating),e.all("input.postratingmenusubmit").setStyle("display","none"),e.addClass("processed"))})},initOptionMenus:function(){r.all(u.OPTIONS_TO_PROCESS).each(function(e){e.removeClass("unprocessed");var t=new r.YUI2.widget.Menu(e.generateID(),{lazyLoad:!0});t.render(r.one(u.CONTAINER).generateID()),r.one("#"+e.getData("controller")).on("click",function(e){e.preventDefault(),t.cfg.setProperty("y",e.currentTarget.getY()+e.currentTarget.get("offsetHeight")),t.cfg.setProperty("x",e.currentTarget.getX()),t.show()})})},handleViewRating:function(e){null===e.currentTarget.ancestor(".helplink")&&(e.preventDefault(),openpopup(e,{url:e.currentTarget.get("href")+"&popup=1",name:"ratings",options:"height=400,width=600,top=0,left=0,menubar=0,location=0,scrollbars,resizable,toolbar,status,directories=0,fullscreen=0,dependent"}))},markPostAsRead:function(e,t,i){this.get("io").send({postid:e,action:"markread"},t,i)},incrementDiscussionCount:function(e){var t=r.one(u.DISCUSSION_COUNT);null!==t&&(t.setData("count",parseInt(t.getData("count"),10)+e),t.setHTML(M.util.get_string("xdiscussions","mod_hsuforum",t.getData("count"))))},displayNotification:function(e){var t=r.Node.create(e);r.one(u.NOTIFICATION).append(t),setTimeout(function(){t.remove(!0)},1e4)},handleNotification:function(e){r.Lang.isString(e.notificationhtml)&&0<e.notificationhtml.trim().length&&this.displayNotification(e.notificationhtml)},handleUpdateDiscussion:function(e){var t=r.one("#discussionsview");t?t.setHTML(e.html):(t=r.one(u.DISCUSSION_BY_ID.replace("%d",e.discussionid)))?(t.replace(e.html),this.initRatings()):r.one(u.DISCUSSION_TARGET).insert(e.html,"after")},handleDiscussionCreated:function(){r.one(u.NO_DISCUSSIONS)&&r.one(u.NO_DISCUSSIONS).remove()},handleDiscussionDeleted:function(e){var t=r.one(u.POST_BY_ID.replace("%d",e.postid));null!==t&&t.hasAttribute("data-isdiscussion")&&(r.one(u.DISCUSSIONS)?(t.remove(!0),this.incrementDiscussionCount(-1),r.one(u.DISCUSSION_COUNT).focus()):window.location.href=e.redirecturl)}}),M.mod_hsuforum.Dom=e,o=r.Base.create("hsuforumRouter",r.Router,[],{initializer:function(){},discussion:function(e){this.get("article").viewDiscussion(e.query.d,e.query.postid)},post:function(e){r.Lang.isUndefined(e.query.reply)?r.Lang.isUndefined(e.query.forum)?r.Lang.isUndefined(e.query["delete"])?r.Lang.isUndefined(e.query.edit)?r.Lang.isUndefined(e.query.prune)||(window.location.href=e.url):this.get("article").get("form").showEditForm(e.query.edit):this.get("article").confirmDeletePost(e.query["delete"]):this.get("article").get("form").showAddDiscussionForm(e.query.forum):this.get("article").get("form").showReplyToForm(e.query.reply)},focusHash:function(e){var t=e.get("href").split("#");setTimeout(function(){try{r.one("#"+t[1]).ancestor("li").focus()}catch(e){}},300)},handleRoute:function(e){1!==e.button||e.ctrlKey||e.metaKey||e.currentTarget.hasClass("disable-router")||e.currentTarget.hasClass("autolink")||e.currentTarget.ancestor(".posting")?-1<e.currentTarget.get("href").indexOf("#")&&this.focusHash(e.currentTarget):this.routeUrl(e.currentTarget.get("href"))&&e.preventDefault()},routeUrl:function(e){return!!this.hasRoute(e)&&(this.save(this.removeRoot(e)),!0)},handleAddDiscussionRoute:function(e){var t;e.preventDefault(),"undefined"!=typeof e.currentTarget&&(t=(e=e.currentTarget.ancestor("form")).one(u.INPUT_FORUM).get("value"),this.save(e.get("action")+"?forum="+t))},handleViewDiscussion:function(e){var t="/discuss.php?d="+e.discussionid;r.Lang.isUndefined(e.postid)||(t=t+"&postid="+e.postid),this.save(t)},hideForms:function(e,t,i){this.get("article").get("form"
).removeAllForms(),i()}},{ATTRS:{article:{value:null},root:{valueFn:function(){return M.cfg.wwwroot.replace(this._regexUrlOrigin,"")+"/mod/hsuforum"}},routes:{value:[{path:"/view.php"},{path:"/discuss.php",callbacks:["hideForms","discussion"]},{path:"/post.php",callbacks:["hideForms","post"]}]}}}),M.mod_hsuforum.Router=o,t.NAME="moodle-mod_hsuforum-form",t.ATTRS={io:{value:null}},r.extend(t,r.Base,{handlePostToGroupsToggle:function(e){var t=e.currentTarget.ancestor("form"),t=t.one("#menugroupinfo");e.currentTarget.get("checked")?t.set("disabled","disabled"):t.set("disabled","")},handleTimeToggle:function(e){e.currentTarget.get("checked")?e.currentTarget.ancestor(".fdate_time_selector").all("select").removeAttribute("disabled"):e.currentTarget.ancestor(".fdate_time_selector").all("select").setAttribute("disabled","disabled")},_displayReplyForm:function(e){var t,i,s=r.one(u.REPLY_TEMPLATE).getHTML(),o=e.one(u.FORM_REPLY_WRAPPER);o instanceof r.Node?o.replace(s):e.append(s),o=e.one(u.FORM_REPLY_WRAPPER),this.attachFormWarnings(),o.one(u.INPUT_REPLY).setAttribute("value",e.getData("postid")),(t=o.one(u.FORM_ADVANCED)).setAttribute("href",t.getAttribute("href").replace(/reply=\d+/,"reply="+e.getData("postid"))),i=o.one("div[id^=editor-target-container-] textarea"),t.on("click",function(e){t.setAttribute("href",t.getAttribute("href")+"&msgcontent="+i.get("value"))}),e.hasAttribute("data-ispost")&&o.one("legend").setHTML(M.util.get_string("replytox","mod_hsuforum",e.getData("author")))},_copyMessage:function(e){var t=e.one(u.EDITABLE_MESSAGE).get("innerHTML"),t=(t=(t=(t=(t=(t=null!==e.one(".editor_atto")?e.one(u.EDITABLE_MESSAGE_ATTO).get("innerHTML"):t).replace(/&amp;/g,"&")).replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/&quot;/g,'"')).replace(/&#39;/g,"'");e.one(u.INPUT_MESSAGE).set("value",t)},_submitReplyForm:function(t,i){var e,s;t.all("button").setAttribute("disabled","disabled"),this._copyMessage(t),e=t.all("form input[type=file]"),(s=r.one("#hiddenadvancededitordraftid"))&&((s=s.cloneNode()).id="hiddenadvancededitordraftidclone",t.one("form input").insert(s,"before")),this.get("io").submitForm(t.one("form"),function(e){e.yuiformsubmit=1,!0===e.errors?(t.one(u.VALIDATION_ERRORS).setHTML(e.html).addClass("notifyproblem"),t.all("button").removeAttribute("disabled")):i.call(this,e)},this,0<e._nodes.length)},attachFormWarnings:function(){require(["core_form/changechecker"],function(i){r.all(u.ALL_FORMS).each(function(e){var t;e.hasClass("form-checker-added")||(t=i.watchFormById(e.generateID()),e.addClass("form-checker-added"),e.one(u.EDITABLE_MESSAGE).on("keypress",i.markAllFormsAsDirty,t))})})},removeAllForms:function(){r.all(u.POSTS+" "+u.FORM_REPLY_WRAPPER).each(function(e){e.ancestor(u.DISCUSSION_EDIT)||e.ancestor(u.POST_EDIT)||e.remove(!0)});var e=r.one(u.ADD_DISCUSSION_TARGET);null!==e&&e.empty()},handleCancelForm:function(e){e.preventDefault();var t=e.target.ancestor(u.POST_TARGET);if(!t)return t=e.target.ancestor(u.ADD_DISCUSSION_TARGET),void e.target.ancestor(u.FORM_REPLY_WRAPPER).remove(!0);t.removeClass(d).removeClass(a),e.target.ancestor(u.FORM_REPLY_WRAPPER).remove(!0),this.fire(h,{discussionid:t.getData("discussionid"),postid:t.getData("postid")})},handleFormSubmit:function(e){e.preventDefault();e=e.currentTarget.ancestor(u.FORM_REPLY_WRAPPER);this._submitReplyForm(e,function(e){switch(e.eventaction){case"postupdated":case"postcreated":this.fire(m,e);break;case"discussioncreated":this.fire(n,e)}})},sendInProgressData:function(e){var t=r.one("div[id^=editor-target-container-] textarea"),i=r.one("input[name=subject]"),s=e.target.getAttribute("href");s.includes("post.php?edit")||e.target.setAttribute("href",e.target.getAttribute("href")+"&msgcontent="+t.get("value")+"&subcontent="+i.get("value"))},showReplyToForm:function(e){e=r.one(u.POST_BY_ID.replace("%d",e));e.hasAttribute("data-ispost")&&this._displayReplyForm(e),e.one(u.EDITABLE_MESSAGE).focus()},setDateField:function(e,t,i){var i=new Date(1e3*i),s=i.getMinutes(),o=i.getHours(),n=i.getDate(),a=i.getMonth()+1,i=i.getFullYear();t?r.one("#id_time"+e+"_enabled").set("checked",!0):r.one("#id_time"+e+"_enabled").set("checked",!1),0<s&&60==(s=5*Math.round(s/5))&&(s=55),r.one("#id_time"+e+"_minute").set("value",s),r.one("#id_time"+e+"_hour").set("value",o),r.one("#id_time"+e+"_day").set("value",n),r.one("#id_time"+e+"_month").set("value",a),r.one("#id_time"+e+"_year").set("value",i),this.setDateFieldsClassState()},resetDateField:function(e){var t;r.one("#discussion_dateform fieldset")&&(t=Math.floor(Date.now()/1e3),this.setDateField(e,!1,t))},resetDateFields:function(){var e,t=["start","end"];for(e in t)this.resetDateField(t[e])},setDateFieldsClassState:function(){var e=r.one("fieldset.dateform_fieldset");e&&e.all(".fdate_selector").each(function(e){e.one("input").get("checked")?e.all("select").removeAttribute("disabled"):e.all("select").setAttribute("disabled","disabled")})},applyDateFields:function(){var s,e,t,i,o;if(r.one(".dateformtarget")){if((s=r.one("#discussion_dateform fieldset"))||((s=r.Node.create("<fieldset/>")).addClass("form-inline"),0<(e=r.all("#discussion_dateform div.row.fitem"))._nodes.length||(t=r.all("#discussion_dateform .form-inline.felement"),i=r.all(".col-form-label.d-inline"),o=[],i.each(function(e){o.push(e.ancestor())}),t.each(function(e,t){var i;0<t&&((i=r.Node.create("<div/>")).addClass("form-group"),s.appendChild(i),i.appendChild(o[t-1]).addClass("row"),i.appendChild(e).addClass("row"))})),e.each(function(e,t){0<t&&s.appendChild(e)})),!s)return;s.addClass("dateform_fieldset"),s.removeClass("hidden"),s.one("legend")&&s.one("legend").remove(),s.all("a.visibleifjs").addClass("disable-router"),r.one(".dateformtarget").append(s)}this.setDateFieldsClassState()},setDateFields:function(e,t){0==e&&this.resetDateField("start"),0==t&&this.resetDateField("end")},setDefaultDateSettings:function(){var e=r.one("#id_timestart_enabled").ancestor(".felement"),t=r.one("#id_timeend_enabled").ancestor(".felement");
e.all("select").setAttribute("disabled","disabled"),t.all("select").setAttribute("disabled","disabled")},showAddDiscussionForm:function(){var t,i,s;r.one(u.ADD_DISCUSSION_TARGET).setHTML(r.one(u.DISCUSSION_TEMPLATE).getHTML()).one(u.INPUT_SUBJECT).focus(),this.resetDateFields(),this.applyDateFields(),this.attachFormWarnings();try{this.setDefaultDateSettings()}catch(e){}t=r.one(u.FORM_ADVANCED),i=r.one("div[id^=editor-target-container-] textarea"),s=r.one("input[name=subject]"),t.on("click",function(e){t.setAttribute("href",t.getAttribute("href")+"&msgcontent="+i.get("value")+"&subcontent="+s.get("value"))})},showEditForm:function(e){var o,n=r.one(u.POST_BY_ID.replace("%d",e));n.hasClass(a)||n.hasClass(d)?n.one(u.EDITABLE_MESSAGE).focus():(o=this,e=r.one("#hiddenadvancededitordraftid"),this.get("io").send({discussionid:n.getData("discussionid"),postid:n.getData("postid"),draftid:e?e.get("value"):0,action:"edit_post_form"},function(e){var t,i,s;n.prepend(e.html),n.hasAttribute("data-isdiscussion")?n.addClass(a):n.addClass(d),n.one(u.EDITABLE_MESSAGE).focus(),e.isdiscussion&&(o.applyDateFields(),t=e.offset,0!=e.timestart||0!=e.timeend?(s=60*(new Date).getTimezoneOffset(),i=parseInt(e.timestart)+parseInt(s)+parseInt(t),s=parseInt(e.timeend)+parseInt(s)+parseInt(t),o.setDateFields(i,s)):o.setDateFields(e.timestart,e.timeend)),this.attachFormWarnings()},this))}}),M.mod_hsuforum.Form=t,i.NAME=s,i.ATTRS={contextId:{value:undefined},io:{readOnly:!0},dom:{readOnly:!0},router:{readOnly:!0},form:{readOnly:!0},liveLog:{readOnly:!0},currentEditLink:null},r.extend(i,r.Base,{initializer:function(){this._set("router",new M.mod_hsuforum.Router({article:this,html5:!1})),this._set("io",new M.mod_hsuforum.Io({contextId:this.get("contextId")})),this._set("dom",new M.mod_hsuforum.Dom({io:this.get("io")})),this._set("form",new M.mod_hsuforum.Form({io:this.get("io")})),this._set("liveLog",M.mod_hsuforum.init_livelog()),this.bind()},bind:function(){var e,t,i,s,o=document.getElementsByClassName("hsuforum-post-unread")[0];if(o&&"#unread"===location.hash){if(o=document.getElementById(o.id).parentNode,navigator.userAgent.match(/Trident|MSIE/)){for(e=o.offsetTop,t=o;t=t.offsetParent;)e+=t.offsetTop;window.scrollTo(0,e)}else o.scrollIntoView();o.focus()}null===r.one(u.SEARCH_PAGE)&&(o=this.get("dom"),i=this.get("form"),s=this.get("router"),r.delegate("click",i.handlePostToGroupsToggle,document,'.hsuforum-discussion input[name="posttomygroups"]',i),r.delegate("click",i.handleTimeToggle,document,"#id_timestart_enabled",i),r.delegate("click",i.handleTimeToggle,document,"#id_timeend_enabled",i),r.delegate("click",i.handleCancelForm,document,u.LINK_CANCEL,i),r.delegate("click",s.handleRoute,document,u.CONTAINER_LINKS,s),r.delegate("click",o.handleViewRating,document,u.RATE_POPUP,o),r.delegate("submit",i.handleFormSubmit,document,u.FORM,i),r.delegate("click",s.handleAddDiscussionRoute,document,u.ADD_DISCUSSION,s),r.delegate("click",i.sendInProgressData,document,u.FORM_ADVANCED,i),i.on(f,o.handleUpdateDiscussion,o),i.on(f,o.handleNotification,o),i.on(f,s.handleViewDiscussion,s),i.on(f,this.handleLiveLog,this),i.on(m,this.handlePostUpdated,this),i.on(n,o.handleUpdateDiscussion,o),i.on(n,o.handleDiscussionCreated,o),i.on(n,o.handleNotification,o),i.on(n,s.handleViewDiscussion,s),i.on(n,this.handleLiveLog,this),this.on(l,o.handleDiscussionDeleted,o),this.on(l,o.handleNotification,o),this.on(l,this.handleLiveLog,this),this.on(c,o.handleUpdateDiscussion,o),this.on(c,s.handleViewDiscussion,s),this.on(c,o.handleNotification,o),this.on(c,this.handleLiveLog,this),i.on(h,s.handleViewDiscussion,s))},handlePostUpdated:function(e){var t=this.get("dom"),i=(this.get("form"),this.get("router"));t.handleUpdateDiscussion(e),i.handleViewDiscussion(e),t.handleNotification(e),this.handleLiveLog(e)},handleLiveLog:function(e){r.Lang.isString(e.livelog)&&this.get("liveLog").logText(e.livelog)},viewDiscussion:function(e,t){var i,e=r.one(u.DISCUSSION_BY_ID.replace("%d",e));e instanceof r.Node&&(r.Lang.isUndefined(t)||null===(i=r.one(u.POST_BY_ID.replace("%d",t)))||i.hasAttribute("data-isdiscussion")?e:i.get("parentNode")).focus()},confirmDeletePost:function(e){null!==r.one(u.POST_BY_ID.replace("%d",e))&&!0===window.confirm(M.str.mod_hsuforum.deletesure)&&this.deletePost(e)},deletePost:function(e){var t=r.one(u.POST_BY_ID.replace("%d",e));null!==t&&this.get("io").send({postid:e,sesskey:M.cfg.sesskey,action:"delete_post"},function(e){t.hasAttribute("data-isdiscussion")?this.fire(l,e):this.fire(c,e)},this)}}),M.mod_hsuforum.Article=i,M.mod_hsuforum.init_article=function(e){new i(e)},M.mod_hsuforum.dispatchClick=function(e){var t;document.createEvent?(t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}),e.dispatchEvent(t)):e.fireEvent&&e.fireEvent("onclick")}},"@VERSION@",{requires:["base","node","event","router","core_rating","querystring","moodle-mod_hsuforum-io","moodle-mod_hsuforum-livelog"]});